webpackJsonp([1],{"2pCB":function(t,e){},DAU5:function(t,e){},"Dkm+":function(t,e){},J8FY:function(t,e){},L6Nk:function(t,e){},MCCq:function(t,e){},NHnr:function(t,e,i){"use strict";function o(t){var e=H.get("serviceToken");return e?(X.headers.Authorization=""+e,G.get("//api.octave-love.com/api/v1/user/getInfo",X)):!(e||!t)&&new j.a(function(e,i){G.post("//api.octave-love.com/api/v1/user/oauth/wechat/callback?code="+t,"",X).then(function(t){20001===t.data.errcode&&i(20001);var e=t.data.data.id_token;return X.headers.Authorization=""+e,H.set("serviceToken",e,{expires:7}),G.get("//api.octave-love.com/api/v1/user/getInfo",X)},function(){i()}).then(function(t){e(t)}).catch(function(t){i(t)})})}function n(t,e){var i=this;return new j.a(function(o,n){var a={headers:{"Content-Type":"multipart/form-data",processData:!1,Authorization:X.headers.Authorization}},s=new Blob([z()(t)]),r=new FileReader;r.onload=function(){var t=D()(W.a.mark(function t(s){var r,c,l,d;return W.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new FormData,r.append("fname","test.txt"),r.append("data",s.target.result),c="",t.prev=4,t.next=7,G.post("//api.octave-love.com/api/v1/uploadAudio",r,a);case 7:c=t.sent,t.next=14;break;case 10:t.prev=10,t.t0=t.catch(4),console.log(t.t0),n(t.t0);case 14:return l=""+c.data.data,d=F()({},e,{url:l}),console.log(l),t.abrupt("return",G.post("//api.octave-love.com/api/v1/work/create",z()(d),X).then(function(t){o(t.data.data)}).catch(function(t){n(t)}));case 18:case"end":return t.stop()}},t,i,[[4,10]])}));return function(e){return t.apply(this,arguments)}}(),r.readAsDataURL(s)})}function a(t){return G.get("//api.octave-love.com/api/v1/work/detail/"+t,X)}function s(t){return G.get("//api.octave-love.com/api/v1/user/detail/"+t,X)}function r(t,e){return G.get("//api.octave-love.com/api/v1/work/getListByUid/"+t+"?page="+e+"&size=15",X)}function c(t,e){return G.get("//api.octave-love.com/api/v1/favorite/getWorkList/"+t+"?page="+e+"&size=15",X)}function l(t){var e=t.workId,i=t.status;return G.post("//api.octave-love.com/api/v1/favorite/create",z()({workId:e,status:i}),X)}function d(t){var e=t.id,i=t.title;return G.put("//api.octave-love.com/api/v1/work/updateWork/"+e,z()({title:i}),X)}function u(){return G.post("//api.octave-love.com/api/v1/home","",X)}function p(t){var e=t.pid,i=t.wid,o=t.amount;return G.post("//api.octave-love.com/api/v1/shop/orders/create?userId=1",z()({pid:e,wid:i,amount:o}),X)}function v(t){var e=t.orderId;return G.post("//api.octave-love.com/api/v1/shop/pay/unifiedorder?orderId="+e,"",X)}function h(t){i("h4Ia")}function m(t){var e=new RegExp("[?|&]"+t+"=([^&]+)"),i=location.search.match(e);return i&&i[1]}function f(t){i("DAU5")}function g(t){console.log("== Enter RealMagic =="),console.log(z()(t));var e={};t.forEach(function(t){var i=parseInt(2*yt.Frequency(t.note).toFrequency(),10);e[i]||(e[i]=[]),e[i].push(t.time)});var i=xt()(e),o=Tt()(e),n=[],a=[];if(i.length>18)return console.log("音种类超过18个，这个做不了"),!1;if(o.forEach(function(t){var e=[];t.forEach(function(i,o){var n=[],a=!1,s=!1;if(0===o)e.push(1);else{for(var r=o;r>=1&&!a;){if(r-=1,i-t[r]>=kt&&-1===n.indexOf(e[r])){e.push(e[r]),s=!0;break}if(-1===n.indexOf(e[r])&&(n.push(e[r]),[].concat(wt()(new gt.a(e))).length===[].concat(wt()(new gt.a(n))).length)){a=!0;break}}(0===r&&!s||a)&&e.push(Math.max.apply(Math,e)+1)}}),a.push(e)}),console.log(i),console.log(o),console.log("hehe",a),a.forEach(function(t,e){for(var o=0;o<=Math.max.apply(Math,wt()(t))-1;)n.push(i[e]),o+=1}),n.length<18)for(var s=n[n.length-1];n.length<18;)n.push(s);else if(n.length>18)return console.log("所需音片儿超过18个"),!1;return!0}function _(t){var e=[151,255,241],i=[137,228,217],o=[143,123,242],n=[0,0,0];return t<0||t>20||t<=10&&(n=[e[0]+t*(i[0]-e[0])/10,e[1]+t*(i[1]-e[1])/10,e[2]+t*(i[2]-e[2])/10]),n=[i[0]+t*(o[0]-i[0])/10,i[1]+t*(o[1]-i[1])/10,i[2]+t*(o[2]-i[2])/10],"rgb("+Math.floor(n[0])+","+Math.floor(n[1])+","+Math.floor(n[2])+")"}function w(t){return""+((yt.Frequency(t).toMidi()-50)/70*60+.2)}function b(t){if(t&&t.length&&t.forEach(function(t){try{t.dispose()}catch(t){}}),Et)try{Et.dispose()}catch(t){}}function T(t,e){if(console.log("current state",yt.Transport.state),e){if(St||(It.triggerAttack("E6",0,0),St=!0),Et)try{Et.dispose()}catch(t){}Et=new yt.Part(function(t,e){It.triggerAttackRelease(e.note,"4n",t)},t).start(0,0),Et.loop=!0,Et.loopEnd=21,yt.Transport.start("+0.01",0)}else yt.Transport.stop(0)}function C(t){i("Dkm+")}function x(t){i("2pCB")}function y(t){i("hMCF")}function k(t){i("XgS5")}function E(t){i("J8FY")}function S(t){i("h6L2")}function I(t){i("L6Nk")}function A(t){i("MCCq")}Object.defineProperty(e,"__esModule",{value:!0});var N=i("7+uW"),R=i("9JMe"),O=(i("e195"),i("1BT9")),P=i.n(O),M=i("NYxO"),U=i("//Fk"),j=i.n(U),B=i("Xxa5"),W=i.n(B),q=i("Dd8w"),F=i.n(q),$=i("exGp"),D=i.n($),L=i("mvHQ"),z=i.n(L),H=i("lbHh"),G=i("mtWM");G.interceptors.response.use(function(t){return"0"!==t.data.errcode?(alert(t.data.resmsg),j.a.reject(t)):t});var X={headers:{Accept:"application/json","Content-Type":"application/json"}},V={BOUNCE_PROJECT:function(t,e){t.commit,t.state;return n(e.record,e.info)},FETCH_MBOX:function(t,e){var i=t.commit,o=(t.state,e.id);return new j.a(function(t,e){a(o).then(function(e){console.log("xxi",e.data.data.url),console.log("xxi",e.data.data.userId),s(e.data.data.userId).then(function(o){console.log("work musixiser info: ",o.data.data),e.data.data.userVO=o.data.data;var n=new XMLHttpRequest;n.open("GET",e.data.data.url,!0),n.send(null),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){-1!==n.getResponseHeader("Content-Type").indexOf("text")&&(i("SET_ID_PROJECT",{record:JSON.parse(n.responseText),info:e.data.data}),t())}}})})})},FETCH_MUSIXISER:function(t,e){var i=t.commit,o=(t.state,e.id);return new j.a(function(t,e){s(o).then(function(e){console.log("musixiser info: ",e.data.data),i("SET_MUSIXISER",{musixiserInfo:e.data.data}),t()})})},FETCH_WORKS_FROM_MUSIXISER:function(t,e){var i=t.commit,o=(t.state,e.id),n=e.page;return new j.a(function(t,e){r(o,n).then(function(e){console.log("works list: ",e.data.data),i("PUSH_MUSIXISER_WORKS",{musixiserWorksObj:e.data.data}),t()})})},FETCH_FAV_WORKS:function(t,e){var i=t.commit,o=(t.state,e.id),n=e.page;return new j.a(function(t,e){c(o,n).then(function(e){console.log("works list: ",e.data.data),i("PUSH_FAV_WORKS",{favWorksObj:e.data.data}),t()})})}},J={SET_USER_INFO:function(t,e){var i=e.type;t.activeType=i},SET_WORK_INFO:function(t,e){var i=e.type,o=e.ids;t.lists[i]=o},SET_MUSIXISER_INFO:function(t,e){e.items.forEach(function(e){e&&N.a.set(t.items,e.id,e)})},SET_BOUNCE_PROJECT:function(t,e){var i=e.record;t.recordProject=i},SET_ID_PROJECT:function(t,e){var i=e.record,o=e.info;t.recordProject=i,t.recordProjectInfo=o},SET_MUSIXISER:function(t,e){var i=e.musixiserInfo;t.musixiserInfo=i},PUSH_MUSIXISER_WORKS:function(t,e){var i=e.musixiserWorksObj;console.log("ccccc",i.current),1==+i.current?t.musixiserWorksObj.content=i.list:t.musixiserWorksObj.content=t.musixiserWorksObj.content.concat(i.list),t.musixiserWorksObj.total=i.total,t.musixiserWorksObj.size=i.size,t.musixiserWorksObj.current=i.current},PUSH_FAV_WORKS:function(t,e){var i=e.favWorksObj;console.log("xxxxxxx",i),1==+i.current?t.favWorksObj.content=i.list:t.favWorksObj.content=t.favWorksObj.content.concat(i.list),t.favWorksObj.total=i.total,t.favWorksObj.size=i.size,t.favWorksObj.current=i.current}},K={activeIds:function(t){var e=t.activeType,i=t.itemsPerPage,o=t.lists,n=Number(t.route.params.page)||1;if(e){var a=(n-1)*i,s=n*i;return o[e].slice(a,s)}return[]},activeItems:function(t,e){return e.activeIds.map(function(e){return t.items[e]}).filter(function(t){return t})}};N.a.use(M.a);var Y={name:"app",data:function(){return{transitionName:"fade"}},beforeRouteUpdate:function(t,e,i){}},Z=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("transition",{attrs:{name:t.transitionName}},[i("router-view")],1)],1)},Q=[],tt={render:Z,staticRenderFns:Q},et=tt,it=i("VU/8"),ot=h,nt=it(Y,et,!1,ot,null,null),at=nt.exports,st=i("/ocq"),rt={name:"hello",data:function(){return{msg:"Welcome to Your Vue.js App"}},methods:{redirectTo:function(t){this.$router.push(t)}},created:function(){var t=document.documentElement;window.rem=t.getBoundingClientRect().width/10,t.style.fontSize=window.rem+"px",/micromessenger/.test(navigator.userAgent.toLowerCase())&&(m("code")||H.get("serviceToken")?o(m("code")).then(function(t){t.data.errcode>=2e4&&(H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri=http://m.musixise.com/music-box&response_type=code&scope=snsapi_userinfo&state=type&quan,url=http://m.musixise.com/music-box&connect_redirect=1#wechat_redirect")),alert("welcome"+t.data.data.realname),console.log("get user info success",t.data.data)}).catch(function(t){H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri=http://m.musixise.com/music-box&response_type=code&scope=snsapi_userinfo&state=type&quan,url=http://m.musixise.com/music-box&connect_redirect=1#wechat_redirect")}):location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri=http://m.musixise.com/music-box&response_type=code&scope=snsapi_userinfo&state=type&quan,url=http://m.musixise.com/music-box&connect_redirect=1#wechat_redirect"))}},ct=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app"},[i("div",{staticClass:"m-logo"}),t._v(" "),i("div",{staticClass:"redirect-button",attrs:{id:"mb-maker"},on:{touchstart:function(e){t.redirectTo("/new-music-box-maker")}}},[t._v("\n      去编曲\n  ")])])},lt=[],dt={render:ct,staticRenderFns:lt},ut=dt,pt=i("VU/8"),vt=f,ht=pt(rt,ut,!1,vt,"data-v-3d40ace0",null),mt=ht.exports,ft=(i("v2ns"),i("lHA8")),gt=i.n(ft),_t=i("Gu7T"),wt=i.n(_t),bt=i("gRE1"),Tt=i.n(bt),Ct=i("fZjL"),xt=i.n(Ct),yt=i("ZnLv");yt.Transport.cancel();var kt=1,Et=void 0,St=!1,It=new yt.Sampler({B3:"B3.[mp3|ogg]",E4:"E4.[mp3|ogg]",G4:"G4.[mp3|ogg]",B4:"B4.[mp3|ogg]","C#5":"Cs5.[mp3|ogg]",E5:"E5.[mp3|ogg]",G5:"G5.[mp3|ogg]",B5:"B5.[mp3|ogg]","C#6":"Cs6.[mp3|ogg]"},{release:1,baseUrl:"//cnbj1.fds.api.xiaomi.com/mbox/audio/mbox/"}).toMaster(),At=i("mtWM"),Nt=i.n(At),Rt=i("fxnj"),Ot=i.n(Rt),Pt={headers:{Accept:"application/json","Content-Type":"application/json"}},Mt=function(){return new j.a(function(t,e){Nt.a.post("//api.octave-love.com/api/v1/wechat/getTicket?url="+encodeURIComponent(window.location.href.split("#")[0]),"",Pt).then(function(e){Ot.a.config({debug:!1,appId:e.data.data.appId,timestamp:e.data.data.timestamp,nonceStr:e.data.data.nonceStr,signature:e.data.data.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","chooseWXPay","openAddress"]}),Ot.a.ready(function(){t(Ot.a)})},function(){e("配置wx.config失败")})})},Ut=function(t){var e=t.title,i=t.desc,o=t.fullPath,n=t.imgUrl,a=o;Ot.a.onMenuShareTimeline({title:e,link:a,imgUrl:n,success:function(){},cancel:function(){}}),Ot.a.onMenuShareAppMessage({title:e,desc:i,link:a,imgUrl:n,success:function(){},cancel:function(){}})},jt=function(t){var e=t.pid,i=t.wid,o=t.amount;return new j.a(function(t,n){p({pid:e,wid:i,amount:o}).then(function(e){alert(z()(e)),v({orderId:e.data.data}).then(function(e){alert(z()(e));var i=e.data.data;Ot.a.chooseWXPay({timestamp:i.timeStamp,nonceStr:i.nonceStr,package:i.package,signType:i.signType,paySign:i.paySign,success:function(e){console.log(e),t(e)}})})})})},Bt=i("GDE4"),Wt=i.n(Bt),qt=i("7QTg"),Ft=i("ZnLv"),$t={},Dt=void 0,Lt=new Ft.Sampler({C4:"C4.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]",A4:"A4.[mp3|ogg]",C5:"C5.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",A5:"A5.[mp3|ogg]",C6:"C6.[mp3|ogg]"},{release:1,baseUrl:"//cnbj1.fds.api.xiaomi.com/mbox/audio/"}).toMaster(),zt=(document.documentElement.getBoundingClientRect().width,Math.max(document.documentElement.clientHeight,window.innerHeight||0),[]),Ht=[],Gt=0,Xt=!0,Vt=void 0,Jt=0,Kt=0,Yt=!1,Zt=[],Qt={components:{swiper:qt.swiper,swiperSlide:qt.swiperSlide,vueSlider:Wt.a},data:function(){return{portraitMode:!0,activeNote:{},recordPart:[],recordParts:[],playing:!1,generalControllerShow:!1,activeSwiperIndex:3,lastActiveSwiperIndex:2,vuetimeline:0,showExtendBtns:!1,alertAppear:!1,bouncing:!1,tutorSession:0,handClass:"",tutorClass:"",timelineConfig:{value:0,width:8,height:"90%",padding:"0",dotSize:20,eventType:"auto",min:0,max:200,interval:1,disabled:!1,show:!0,tooltip:"always",piecewise:!1,reverse:!0,style:{display:"inline-block"},class:"star-slider",direction:"vertical",speed:.1,bgStyle:{backgroundColor:"rgb(110,113,158)",boxShadow:"inset 0.5px 0.5px 3px 1px rgba(0,0,0,.36)"},tooltipDir:"left",tooltipStyle:{backgroundColor:"rgb(69, 106, 255)",borderColor:"rgb(69, 106, 255)",transform:"rotate(90deg)",transformOrigin:"right",position:"relative",left:"-.2rem",top:"0.9rem"},formatter:function(t){return t?(t/10).toFixed(1)+"s/20s":"0.0s/20s"},processStyle:{backgroundColor:"rgb(69,106,255)"}}}},watch:{playing:function(t){var e=this;console.log("playing status",t),t?Vt=setInterval(function(){e.vuetimeline+=1,e.vuetimeline>=200&&(e.toggleReplay(),e.vuetimeline=0)},100):clearInterval(Vt)}},computed:{swiper:function(){return this.$refs.pianoRoll.swiper},activePartIndex:function(){return this.PARTNUM-this.activeSwiperIndex-1},lastActivePartIndex:function(){return this.PARTNUM-this.lastActiveSwiperIndex-1}},methods:{load:function(){},toggleReplay:function(){console.log(1),this.playing=!this.playing,this.playing?(this.vuetimeline>=200&&(this.vuetimeline=0),Jt=performance.now()-100*this.vuetimeline,console.log("播放开始"),this.confirmRecordPart(0),console.log("kokokoko"),Gt=performance.now(),console.log("activeOffsetTime"+100*this.vuetimeline),Ft.Transport.start("+0.01",100*this.vuetimeline/1e3)):(console.log("播放停了"),Ft.Transport.stop(0))},handleNoteStart:function(t){var e=0;Lt.triggerAttack(t),this.$set(this.activeNote,t,1),this.playing?e=performance.now()-Jt:(Xt&&(Gt=performance.now(),Kt=100*this.vuetimeline,Xt=!1),e=performance.now()-Gt+Kt),e<2e4?(this.vuetimeline=10*e/1e3,this.recordPart.push({note:t,time:+(e/1e3).toFixed(4)})):(this.vuetimeline=200,console.log("cannot record more than 20 seconds"))},handleNoteEnd:function(t){Lt.triggerRelease(t),this.$set(this.activeNote,t,0)},touchNoteStartHandler:function(t){console.log(t),$t[t.changedTouches[0].identifier]=t.target.id,this.handleNoteStart(t.target.id)},touchNoteEndHandler:function(t){this.handleNoteEnd(t.target.id),this.handleNoteEnd($t[t.changedTouches[0].identifier])},confirmRecordPart:function(t){if(this.recordPart.length){if(console.log("processing track: ",this.lastActivePartIndex),this.recordParts[this.lastActivePartIndex]&&this.recordParts[this.lastActivePartIndex].length&&(this.recordPart=this.recordPart.concat(this.recordParts[this.lastActivePartIndex])),zt[this.lastActivePartIndex])try{zt[this.lastActivePartIndex].dispose()}catch(t){}zt[this.lastActivePartIndex]=new Ft.Part(function(t,e){Lt.triggerAttackRelease(e.note,"8n",t)},this.recordPart).start(0),this.recordParts[this.lastActivePartIndex]=this.recordPart,this.recordPart=[]}else console.log("啥也没录");this.lastActiveSwiperIndex=this.activeSwiperIndex,t&&(this.vuetimeline=0,Gt=0),Xt=!0},clearRecordPart:function(t){if(console.log("cleaning track "+t),this.activePartIndex===t&&(this.recordPart=[],this.vuetimeline=0,Xt=!0,this.playing=!1,Ft.Transport.stop(0)),this.recordParts[t]&&this.recordParts[t].length){if(this.$set(this.recordParts,t,[]),zt[t]){try{zt[t].dispose()}catch(t){}zt[t]=void 0}}else console.log("track "+t+" has no content")},checkBouncibility:function(){return this.confirmRecordPart(0),Ht=[],!zt.length||(zt.forEach(function(t){t&&t._events.length&&t._events[0].value&&t._events.forEach(function(t){Ht.push(t.value)})}),Ht.sort(function(t,e){return 0+t.time-e.time}),g(Ht))},bounceProject:function(){var t=this;this.confirmRecordPart(0),console.log(this),console.log(zt),Ht=[],zt.length?(zt.forEach(function(t){t&&t._events.length&&t._events[0].value&&t._events.forEach(function(t){Ht.push(t.value)})}),Ht.sort(function(t,e){return 0+t.time-e.time}),this.bouncing=!0,this.$store.dispatch("BOUNCE_PROJECT",{record:Ht,info:{title:"尚未起名",content:"default",cover:"default"}}).then(function(e){console.log("successfully bounced"),t.bouncing=!1,t.$toast("作品已为您存储"),t.$router.push({path:"/new-music-box-viewer",query:{id:e}})}).catch(function(e){t.bouncing=!1,t.$toast("非常抱歉，上传作品失败了")})):this.$toast("什么都没录呢")},mapNoteTimeToColor:function(t){return _(t)},mapNoteMidiToLength:function(t){return w(t)},adjustTimeline:function(t){this.playing?(console.log("ccccccccc"),this.toggleReplay()):Xt=!0},onMiniKeyboardScroll:function(t){console.log(t.touches[0].clientY)},onMiniKeyboardStart:function(t){console.log(t)},keng:function(t){console.log(t);for(var e=0;e<=t.changedTouches.length-1;e++){var i=document.elementFromPoint(t.changedTouches[e].clientX,t.changedTouches[e].clientY);i.classList.contains("white")||i.classList.contains("black")?$t[t.changedTouches[e].identifier]&&$t[t.changedTouches[e].identifier]!=i.getAttribute("id")?(console.log($t),this.handleNoteStart(i.getAttribute("id")),this.handleNoteEnd($t[t.changedTouches[e].identifier]),$t[t.changedTouches[e].identifier]=i.getAttribute("id")):$t[t.changedTouches[e].identifier]?console.log(3):(console.log(2),this.handleNoteStart(i.getAttribute("id")),$t[t.changedTouches[e].identifier]=i.getAttribute("id")):(console.log("外边"),$t[t.changedTouches[e].identifier]&&this.handleNoteEnd($t[t.changedTouches[e].identifier]),$t[t.changedTouches[e].identifier]=void 0)}},btnStart:function(t){var e=this;console.log(t),Dt=setTimeout(function(){e.showExtendBtns=!0},200)},btnEnd:function(t){clearTimeout(Dt);var e=document.elementFromPoint(t.changedTouches[0].clientX,t.changedTouches[0].clientY);console.log(e),e&&e.classList.contains("bounceBtn")?this.checkBouncibility()?this.bounceProject():this.alertAppear=!0:e&&(e.classList.contains("playBtn")||e.classList.contains("pauseBtn"))?(this.toggleReplay(),this.showExtendBtns=!1):e&&(e.classList.contains("playBtn")||e.classList.contains("cancelBtn"))&&(this.showExtendBtns=!1)},tutorStart:function(){this.tutorSession=1,this.$toast("请锁住竖屏使用"),Yt=setTimeout(this.tutorProgress,3e3)},tutorProgress:function(){var t=this;switch(clearTimeout(Yt),console.log("??????????"),this.tutorSession+=1,console.log(this.tutorSession),this.tutorSession){case 1:this.clearTutorTimeout(),this.$toast("请锁住竖屏使用,长按播放按钮保存作品");break;case 2:this.clearTutorTimeout(),this.handClass="hand",this.tutorClass="tutor2start",Zt.push(setTimeout(function(){t.handClass="clickhand",t.tutorClass="tutor2end"},500)),Zt.push(setTimeout(function(){t.vuetimeline=120,t.handClass="hand"},1500)),Zt.push(setTimeout(function(){t.vuetimeline=0,t.handClass="hidehand"},2500));break;case 3:this.clearTutorTimeout(),this.handClass="hand",this.tutorClass="tutor3start",Zt.push(setTimeout(function(){t.handClass="clickhand",t.tutorClass="tutor3end"},500)),Zt.push(setTimeout(function(){t.handClass="hand",t.tutorClass="tutor3end"},800)),Zt.push(setTimeout(function(){t.handClass="hidehand"},1e3));break;case 4:this.clearTutorTimeout(),this.handClass="hand",this.tutorClass="tutor4start",Zt.push(setTimeout(function(){t.handClass="clickhand",t.tutorClass="tutor4end"},500)),Zt.push(setTimeout(function(){t.handClass="hand",t.tutorClass="tutor4start",t.showExtendBtns=!0},1500)),Zt.push(setTimeout(function(){t.handClass="hidehand"},2500)),Zt.push(setTimeout(function(){t.showExtendBtns=!1},3e3));break;case 5:this.clearTutorTimeout(),this.handClass="hand",this.tutorClass="tutor5start",Zt.push(setTimeout(function(){t.handClass="clickhand",t.tutorClass="tutor5end"},1200)),Zt.push(setTimeout(function(){t.swiper.slidePrev()},1500)),Zt.push(setTimeout(function(){t.swiper.slideNext(),t.handClass="hidehand"},2500));break;case 6:this.clearTutorTimeout(),this.handClass="hand",this.tutorClass="tutor6start",Zt.push(setTimeout(function(){t.handClass="clickhand",t.tutorClass="tutor6end"},500)),Zt.push(setTimeout(function(){t.handClass="hand",t.tutorClass="tutor6end"},800)),Zt.push(setTimeout(function(){t.handClass="hidehand"},1500));break;default:this.tutorSession=0}},clearTutorTimeout:function(){this.showExtendBtns=!1,Zt.forEach(function(t){return clearTimeout(t)}),Zt=[]}},created:function(){var t=this;Ft.Transport.cancel(),zt=[],Ht=[];var e=document.documentElement;window.rem=e.getBoundingClientRect().width/10,e.style.fontSize=window.rem+"px",this.PARTNUM=3,this.pianoRollSwiperOption={initialSlide:this.PARTNUM,slidesPerView:3,on:{transitionEnd:function(e){console.log("3",this.activeIndex),t.activeSwiperIndex=this.activeIndex,t.confirmRecordPart(!Xt)}}},/micromessenger/.test(navigator.userAgent.toLowerCase())&&(Mt().then(function(){Ut({title:"MUSIXISE",desc:"寻找你自己的八音盒",fullPath:""+location.origin+location.pathname+"#/new-music-box-maker",imgUrl:"http://oaeyej2ty.bkt.clouddn.com/Ocrg2srw_icon33@2x.png"})}),m("code")||H.get("serviceToken")?o(m("code")).then(function(t){t.data.errcode>=2e4&&(H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(location.origin+location.pathname+"#/new-music-box-maker")+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")),console.log("get user info success",t.data.data)}).catch(function(t){H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(location.origin+location.pathname+"#/new-music-box-maker")+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")}):location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(location.origin+location.pathname+"#/new-music-box-maker")+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"))},beforeRouteLeave:function(t,e,i){b(zt),i()},mounted:function(){this.tutorStart()},updated:function(){}},te=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"container"}},[i("div",{class:["keys",8===t.tutorSession?"tutorial-highlight":""],on:{touchmove:t.keng,touchstart:function(e){e.stopPropagation(),e.preventDefault(),t.touchNoteStartHandler(e)},touchend:function(e){if(!("button"in e)&&t._k(e.keyCode,"event",void 0,e.key))return null;e.stopPropagation(),t.touchNoteEndHandler(e)}}},[i("div",{class:["white","c",t.activeNote.C4?"active-note":""],attrs:{id:"C4"}}),t._v(" "),i("div",{class:["black","d-minor",t.activeNote.Db4?"active-note":""],attrs:{id:"Db4"}}),t._v(" "),i("div",{class:["white","d",t.activeNote.D4?"active-note":""],attrs:{id:"D4"}}),t._v(" "),i("div",{class:["black","e-minor",t.activeNote.Eb4?"active-note":""],attrs:{id:"Eb4"}}),t._v(" "),i("div",{class:["white","e",t.activeNote.E4?"active-note":""],attrs:{id:"E4"}}),t._v(" "),i("div",{class:["white","f",t.activeNote.F4?"active-note":""],attrs:{id:"F4"}}),t._v(" "),i("div",{class:["black","f-sharp",t.activeNote.Gb4?"active-note":""],attrs:{id:"Gb4"}}),t._v(" "),i("div",{class:["white","g",t.activeNote.G4?"active-note":""],attrs:{id:"G4"}}),t._v(" "),i("div",{class:["black","a-minor",t.activeNote.Ab4?"active-note":""],attrs:{id:"Ab4"}}),t._v(" "),i("div",{class:["white","a",t.activeNote.A4?"active-note":""],attrs:{id:"A4"}}),t._v(" "),i("div",{class:["black","b-minor",t.activeNote.Bb4?"active-note":""],attrs:{id:"Bb4"}}),t._v(" "),i("div",{class:["white","b",t.activeNote.B4?"active-note":""],attrs:{id:"B4"}}),t._v(" "),i("div",{class:["white","c",t.activeNote.C5?"active-note":""],attrs:{id:"C5"}}),t._v(" "),i("div",{class:["black","d-minor",t.activeNote.Db5?"active-note":""],attrs:{id:"Db5"}}),t._v(" "),i("div",{class:["white","d",t.activeNote.D5?"active-note":""],attrs:{id:"D5"}}),t._v(" "),i("div",{class:["black","e-minor",t.activeNote.Eb5?"active-note":""],attrs:{id:"Eb5"}}),t._v(" "),i("div",{class:["white","e",t.activeNote.E5?"active-note":""],attrs:{id:"E5"}}),t._v(" "),i("div",{class:["white","f",t.activeNote.F5?"active-note":""],attrs:{id:"F5"}}),t._v(" "),i("div",{class:["black","f-sharp",t.activeNote.Gb5?"active-note":""],attrs:{id:"Gb5"}}),t._v(" "),i("div",{class:["white","g",t.activeNote.G5?"active-note":""],attrs:{id:"G5"}}),t._v(" "),i("div",{class:["black","a-minor",t.activeNote.Ab5?"active-note":""],attrs:{id:"Ab5"}}),t._v(" "),i("div",{class:["white","a",t.activeNote.A5?"active-note":""],attrs:{id:"A5"}}),t._v(" "),i("div",{class:["black","b-minor",t.activeNote.Bb5?"active-note":""],attrs:{id:"Bb5"}}),t._v(" "),i("div",{class:["white","b",t.activeNote.B5?"active-note":""],attrs:{id:"B5"}}),t._v(" "),i("div",{class:["white","c",t.activeNote.C6?"active-note":""],attrs:{id:"C6"}}),t._v(" "),i("div",{class:["black","d-minor",t.activeNote.Db6?"active-note":""],attrs:{id:"Db6"}}),t._v(" "),i("div",{class:["white","d",t.activeNote.D6?"active-note":""],attrs:{id:"D6"}}),t._v(" "),i("div",{class:["black","e-minor",t.activeNote.Eb6?"active-note":""],attrs:{id:"Eb6"}}),t._v(" "),i("div",{class:["white","e",t.activeNote.E6?"active-note":""],attrs:{id:"E6"}}),t._v(" "),i("div",{class:["white","f",t.activeNote.F6?"active-note":""],attrs:{id:"F6"}})]),t._v(" "),i("div",{class:["keyshadow",8===t.tutorSession?"tutorial-highlight":""]}),t._v(" "),i("div",{staticClass:"scroll-container"}),t._v(" "),i("div",{staticClass:"semi-piano-roll",class:[5===t.tutorSession||6===t.tutorSession?"tutorial-highlight":""],on:{touchmove:function(t){t.stopPropagation(),t.preventDefault()}}},[i("swiper",{ref:"pianoRoll",attrs:{options:t.pianoRollSwiperOption}},[t._l(t.PARTNUM,function(e){return i("swiper-slide",[i("div",{staticClass:"current-piano-roll"},[i("svg",{style:{height:"90%",padding:t.timelineConfig.dotSize/2+"px 0"}},[i("defs",[i("filter",{attrs:{id:"glowing",height:"400%",width:"130%",x:"-10%",y:"-130%"}},[i("feMorphology",{attrs:{operator:"dilate",radius:"1",in:"SourceAlpha",result:"thicken"}}),t._v(" "),i("feGaussianBlur",{attrs:{in:"thicken",stdDeviation:"2",result:"blurred"}}),t._v(" "),i("feFlood",{attrs:{"flood-color":"rgb(200,200,255)",result:"glowColor"}}),t._v(" "),i("feComposite",{attrs:{in:"glowColor",in2:"blurred",operator:"in",result:"softGlow_colored"}}),t._v(" "),i("feMerge",[i("feMergeNode",{attrs:{in:"softGlow_colored"}}),t._v(" "),i("feMergeNode",{attrs:{in:"SourceGraphic"}})],1)],1)]),t._v(" "),t._l(t.recordPart,function(o,n){return t.activePartIndex===t.PARTNUM-e?i("rect",{attrs:{x:2,y:100*o.time/20+"%",width:t.mapNoteMidiToLength(o.note),height:"3",rx:"2",ry:"2",fill:t.mapNoteTimeToColor(o.time),filter:"url(#glowing)"}}):t._e()}),t._v(" "),t._l(t.recordParts[t.PARTNUM-e],function(o,n){return i("rect",{attrs:{x:2,y:100*o.time/20+"%",width:t.mapNoteMidiToLength(o.note),height:"3",rx:"2",ry:"2",fill:t.activePartIndex===t.PARTNUM-e?t.mapNoteTimeToColor(o.time):"rgb(120,120,120)",filter:t.activePartIndex===t.PARTNUM-e?"url(#glowing)":""}})})],2),t._v(" "),i("div",{staticClass:"temp",on:{click:function(i){t.clearRecordPart(t.PARTNUM-e)}}})])])}),t._v(" "),i("swiper-slide"),t._v(" "),i("swiper-slide")],2)],1),t._v(" "),i("div",{staticClass:"g-controller"},[i("vue-slider",t._b({class:[2===t.tutorSession?"tutorial-highlight":""],on:{callback:t.adjustTimeline,"drag-end":function(t){}},model:{value:t.vuetimeline,callback:function(e){t.vuetimeline=e},expression:"vuetimeline"}},"vue-slider",t.timelineConfig,!1)),t._v(" "),i("div",{staticClass:"btnContainer",class:[3===t.tutorSession||4===t.tutorSession?"tutorial-highlight":""],on:{touchstart:function(e){e.stopPropagation(),e.preventDefault(),t.btnStart(e)},touchend:function(e){if(!("button"in e)&&t._k(e.keyCode,"event",void 0,e.key))return null;e.stopPropagation(),t.btnEnd(e)}}},[i("div",{class:[t.playing?"pauseBtn":"playBtn","rotate"],on:{click:t.toggleReplay}}),t._v(" "),i("div",{class:[t.showExtendBtns?"extendBtnsShow":"extendBtnsHide","extendBtns"]},[i("div",{staticClass:"bounceBtn rotate"}),t._v(" "),i("div",{staticClass:"cancelBtn"})])])],1),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.alertAppear,expression:"alertAppear"}],attrs:{id:"alert-mask"}},[i("div",{staticClass:"mb-dialog"},[i("div",{staticClass:"title"},[t._v("\n          减少些音符才能做成音乐盒，是否继续上传\n        ")]),t._v(" "),i("div",{staticClass:"btns"},[i("span",{staticClass:"btn cancel",on:{click:function(e){t.alertAppear=!1}}},[t._v("再调整")]),t._v(" "),i("span",{staticClass:"btn confirm",on:{click:t.bounceProject}},[t._v("任性上传")])])])])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.bouncing,expression:"bouncing"}],staticClass:"mask"},[i("p",[t._v("存储中...")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.tutorSession>0,expression:"tutorSession>0"}],staticClass:"hint-mask",attrs:{id:"tutorial-mask"},on:{touchend:t.tutorProgress}},[i("div",{directives:[{name:"show",rawName:"v-show",value:2===t.tutorSession,expression:"tutorSession===2"}],staticClass:"hint-text",attrs:{id:"timeline-hint"}},[i("h3",[t._v("进度条")]),i("p",[t._v("拖动原点改变时间")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:3===t.tutorSession,expression:"tutorSession===3"}],staticClass:"hint-text",attrs:{id:"play-hint"}},[i("h3",[t._v("功能按钮")]),i("p",[t._v("点击播放/暂停")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:4===t.tutorSession,expression:"tutorSession===4"}],staticClass:"hint-text",attrs:{id:"longpress-hint"}},[i("h3",[t._v("功能按钮")]),i("p",[t._v("长按后点击：保存/取消")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:5===t.tutorSession,expression:"tutorSession===5"}],staticClass:"hint-text",attrs:{id:"swipe-hint"}},[i("h3",[t._v("多轨编曲")]),i("p",[t._v("上下滑动切换轨道编曲")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:6===t.tutorSession,expression:"tutorSession===6"}],staticClass:"hint-text",attrs:{id:"clear-hint"}},[i("h3",[t._v("多轨编曲")]),i("p",[t._v("清空轨道")])])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"hidehand"!=t.handClass,expression:"handClass!='hidehand'"}],class:[t.tutorClass],attrs:{id:"tutorhand"}},[i("div",{class:[t.handClass]})])],1)},ee=[],ie={render:te,staticRenderFns:ee},oe=ie,ne=i("VU/8"),ae=C,se=ne(Qt,oe,!1,ae,"data-v-4ac33d9c",null),re=se.exports,ce={props:{initCount:Number,initActive:Boolean,iconImg:String,onClickCall:{type:Function,default:function(){return function(){console.log("tap tap in count Button")}}}},computed:{style:function(){}},data:function(){return{currentActiveCount:0,currentActive:!1}},watch:{},created:function(){this.currentActive=this.initActive,this.currentActiveCount=this.currentActive?this.initCount:this.initCount+1},mounted:function(){},updated:function(){},methods:{updateButton:function(){this.currentActive=!this.currentActive,this.onClickCall()}}},le=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"btnContainer",on:{click:t.updateButton}},[i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.currentActive,expression:"currentActive"}],staticClass:"active-btn-background"})]),t._v(" "),i("transition",{attrs:{name:"slideDown"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.currentActive,expression:"currentActive"}],staticClass:"btn active"},[i("div",{}),t._v(" "),i("p",[t._v(t._s(t.currentActiveCount))])])]),t._v(" "),i("transition",{attrs:{name:"slideUp"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.currentActive,expression:"!currentActive"}],staticClass:"btn inactive"},[i("div",{}),t._v(" "),i("p",[t._v(t._s(t.currentActiveCount-1))])])])],1)},de=[],ue={render:le,staticRenderFns:de},pe=ue,ve=i("VU/8"),he=x,me=ve(ce,pe,!1,he,"data-v-55643781",null),fe=me.exports,ge={components:{countButton:fe},data:function(){return{loading:!0,workIntroAppear:!1,controlPanalAppear:!1,titleUpdateAppear:!1,playing:!1,userId:0,favStatus:!1,newWorkTitle:"",finalNewWorkTitle:""}},computed:{project:function(){return this.$store.state.recordProject},projectInfo:function(){return this.$store.state.recordProjectInfo}},methods:{load:function(){},loadMusicById:function(){var t=this;alert(1),console.log("hehe",this.$store.state);var e=this.$store.state.route.query.id;e?(console.log("mmm",e),this.$store.dispatch("FETCH_MBOX",{id:e}).then(function(){console.log("workPart",t.project),console.log("work info",t.projectInfo),t.favStatus=t.projectInfo.favStatus;var e=""+location.origin+location.pathname+"#/new-music-box-viewer?id="+t.$store.state.route.query.id;Ut({title:"MUSIXISE",desc:"来听"+t.projectInfo.userVO.realname+"的作品-"+t.projectInfo.title,fullPath:e,imgUrl:"http://oaeyej2ty.bkt.clouddn.com/Ocrg2srw_icon33@2x.png"})})):this.$store.dispatch("FETCH_MBOX",{id:50}).then(function(){console.log("workPart",t.project),console.log("work info",t.projectInfo),t.favStatus=t.projectInfo.favStatus})},togglePlay:function(){T(this.project,!this.playing),this.playing=!this.playing},toggleFav:function(){this.favStatus=+!this.favStatus,l({workId:this.$store.state.route.query.id,status:this.favStatus}).then(function(){}).catch(function(t){})},updateWorkTitle:function(){var t=this;d({id:this.$store.state.route.query.id,title:this.newWorkTitle}),this.finalNewWorkTitle=this.newWorkTitle;var e=""+location.origin+location.pathname+"#/new-music-box-viewer?id="+this.$store.state.route.query.id;Ut({title:"MUSIXISE",desc:"来听"+this.projectInfo.userVO.realname+"的作品-"+this.newWorkTitle,fullPath:e,imgUrl:"http://oaeyej2ty.bkt.clouddn.com/Ocrg2srw_icon33@2x.png"}),setTimeout(function(){t.titleUpdateAppear=!1},300)},redirectToMaker:function(){this.$router.push({path:"/new-music-box-maker"})},redirectToMusixiser:function(t){t&&this.$router.push({path:"/musixiser",query:{id:t}})},purchaseItem:function(){console.log("you are about to purchase "+this.projectInfo.id),jt({pid:1,wid:this.projectInfo.id,amount:1}).then(function(t){console.log("pay succeed")}).catch(function(t){console.log("pay fail")})}},beforeRouteLeave:function(t,e,i){b(),i()},created:function(){alert(1);var t=this,e=document.documentElement;if(window.rem=e.getBoundingClientRect().width/10,e.style.fontSize=window.rem+"px",!/micromessenger/.test(navigator.userAgent.toLowerCase()))return void t.loadMusicById();var i=""+location.origin+location.pathname+"#/new-music-box-viewer?id="+t.$store.state.route.query.id;Mt().then(function(){Ut({title:"MUSIXISE",desc:"分享一个八音盒",fullPath:i,imgUrl:"https://oaeyej2ty.bkt.clouddn.com/Ocrg2srw_icon33@2x.png"})}),m("code")||H.get("serviceToken")?o(m("code")).then(function(e){e.data.errcode>=2e4&&(H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(i)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")),t.userId=e.data.data.userId,t.loadMusicById(),console.log("get user info success",e.data.data)}).catch(function(t){H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(i)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")}):location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(i)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")},mounted:function(){var t=this;setTimeout(function(){t.loading=!1},2e3),setTimeout(function(){t.workIntroAppear=!0},4500),setTimeout(function(){t.controlPanalAppear=!0},5500)},updated:function(){}},_e=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:["container",t.loading?"loading":""]},[i("div",{attrs:{id:"ground"}}),t._v(" "),t._m(0,!1,!1),t._v(" "),i("div",{attrs:{id:"mb"},on:{click:t.togglePlay}},[i("div",{class:["mb-part",t.playing?"playing":""],attrs:{id:"mb-lid"}}),t._v(" "),i("div",{staticClass:"mb-part",attrs:{id:"mb-body"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.playing,expression:"!playing"}],attrs:{id:"play-btn"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.playing,expression:"playing"}],attrs:{id:"pause-btn"}})]),t._v(" "),i("div",{class:[t.playing?"":"not-playing"],attrs:{id:"mb-shiner"}})]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.playing,expression:"playing"}],attrs:{id:"music-aurora"}})]),t._v(" "),i("div",{attrs:{id:"low-leaf1"}}),t._v(" "),i("div",{attrs:{id:"low-leaf2"}}),t._v(" "),i("div",{attrs:{id:"low-leaf3"}}),t._v(" "),i("div",{attrs:{id:"low-leaf4"}}),t._v(" "),i("div",{attrs:{id:"mid-leaf1"}}),t._v(" "),i("div",{attrs:{id:"mid-leaf2"}}),t._v(" "),i("div",{attrs:{id:"mid-leaf3"}}),t._v(" "),i("div",{attrs:{id:"mid-leaf4"}}),t._v(" "),i("div",{attrs:{id:"top-leaf1"}}),t._v(" "),i("div",{attrs:{id:"top-leaf2"}}),t._v(" "),i("div",{attrs:{id:"top-leaf3"}}),t._v(" "),i("div",{attrs:{id:"top-leaf4"}}),t._v(" "),i("div",{attrs:{id:"top-leaf5"}}),t._v(" "),i("div",{attrs:{id:"top-leaf6"}}),t._v(" "),i("transition",{attrs:{name:"bounce"}},[t.workIntroAppear?i("div",{attrs:{id:"work-intro"}},[i("div",{staticClass:"title",on:{click:function(e){t.userId===t.projectInfo.userId?t.titleUpdateAppear=!0:t.titleUpdateAppear=!1}}},[t._v(t._s(t.finalNewWorkTitle||t.projectInfo.title))]),t._v(" "),i("div",{staticClass:"subtitle"},[i("span",[t._v("by")]),t._v(" "),i("span",{on:{click:function(e){t.redirectToMusixiser(t.projectInfo.userVO.userId)}}},[i("img",{attrs:{src:t.projectInfo.userVO.smallAvatar,alt:""}})]),t._v(" "),i("span",[t._v(t._s(t.projectInfo.userVO.realname))])]),t._v(" "),t.userId===t.projectInfo.userId?i("div",{attrs:{id:"edit-work"},on:{click:function(e){t.titleUpdateAppear=!0}}}):t._e()]):t._e()]),t._v(" "),i("transition",{attrs:{name:"bounce"}},[t.controlPanalAppear?i("div",{attrs:{id:"control-panal"}},[i("count-button",{attrs:{initCount:t.projectInfo.collectNum?t.projectInfo.collectNum:0,initActive:!!t.projectInfo.favStatus,iconImg:"",onClickCall:t.toggleFav}}),t._v(" "),i("div",{staticClass:"purchaseBtn",on:{click:t.purchaseItem}},[t._v("购买")]),t._v(" "),i("div",{staticClass:"makeBtn",on:{click:t.redirectToMaker}},[t._v("编曲")])],1):t._e()]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.titleUpdateAppear,expression:"titleUpdateAppear"}],attrs:{id:"title-update-mask"}},[i("div",{staticClass:"mb-dialog"},[i("div",{staticClass:"title"},[t._v("作品名称")]),t._v(" "),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.newWorkTitle,expression:"newWorkTitle"}],attrs:{type:"text",placeholder:"作品新名称"},domProps:{value:t.newWorkTitle},on:{input:function(e){e.target.composing||(t.newWorkTitle=e.target.value)}}}),t._v(" "),i("div",{staticClass:"splitter"})]),t._v(" "),i("div",{staticClass:"btns"},[i("span",{staticClass:"btn cancel",on:{click:function(e){t.titleUpdateAppear=!1}}},[t._v("取消")]),t._v(" "),i("span",{staticClass:"btn confirm",on:{click:t.updateWorkTitle}},[t._v("确认")])])])])])],1)},we=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"spirit"}},[i("div",{staticClass:"spirit-part",attrs:{id:"spirit-body"}}),t._v(" "),i("div",{staticClass:"spirit-part",attrs:{id:"spirit-front-leaf"}}),t._v(" "),i("div",{staticClass:"spirit-part",attrs:{id:"spirit-back-leaf"}}),t._v(" "),i("div",{staticClass:"spirit-part",attrs:{id:"spirit-back1"}}),t._v(" "),i("div",{staticClass:"spirit-part",attrs:{id:"spirit-back2"}})])}],be={render:_e,staticRenderFns:we},Te=be,Ce=i("VU/8"),xe=y,ye=Ce(ge,Te,!1,xe,"data-v-2bd592c4",null),ke=ye.exports,Ee={props:{progress:Number},computed:{style:function(){}},data:function(){return{}},watch:{},created:function(){},mounted:function(){},updated:function(){},methods:{updateButton:function(){}}},Se=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"pie-wrapper pie-wrapper--solid"},[i("div",{staticClass:"before",style:{background:t.progress<=50?"#25252b":"#979797",transform:t.progress<=50?"rotate("+(100-t.progress)/100*-360+"deg)":"rotate("+(t.progress-50)/100*360+"deg)"}})])])},Ie=[],Ae={render:Se,staticRenderFns:Ie},Ne=Ae,Re=i("VU/8"),Oe=k,Pe=Re(Ee,Ne,!1,Oe,"data-v-6a56a6f0",null),Me=Pe.exports,Ue=i("rc1w"),je=i.n(Ue);window.Tone=i("ZnLv");var Be=[0,2,4,5,7,9,11,12,14,16,17,19,21,23,24,26,28,29],We=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18];We.fill("#9FB2CF",0,18),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18].fill("#7D90AD",0,18);var qe=-1,Fe=-1;window.cursorSchedules=[];var $e=void 0,De=void 0;N.a.use(je.a);var Le=new Tone.Sampler({C4:"C4.[mp3|ogg]","D#4":"Ds4.[mp3|ogg]","F#4":"Fs4.[mp3|ogg]",A4:"A4.[mp3|ogg]",C5:"C5.[mp3|ogg]","D#5":"Ds5.[mp3|ogg]","F#5":"Fs5.[mp3|ogg]",A5:"A5.[mp3|ogg]",C6:"C6.[mp3|ogg]"},{release:1,baseUrl:"//cnbj1.fds.api.xiaomi.com/mbox/audio/"}).toMaster(),ze={oscillator:{type:"triangle"},envelope:{release:.07}},He=(new Tone.PolySynth(18,Tone.Synth,ze).toMaster(),{components:{pieProgress:Me},data:function(){return{NOTE_CATEGORY:18,ONE_PAGE_NOTE_NUM:20,NOTE_NUM_PER_SECTOR:10,tempo:80,configKonva:{width:0,height:0},configNoteRect:{},activeJ:-1,sector:1,rectArray:[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],alertAppear:!1,showExtendBtns:!1,playing:!1,currentTime:0}},filters:{intTime:function(t){return Math.floor(t)%20}},computed:{tempoLength:function(){var t=100/120;return{height:t*this.tempo-50+"%"}}},methods:{setupCanvas:function(){var t=document.documentElement;this.configKonva={width:t.getBoundingClientRect().width-50,height:window.innerHeight},this.configNoteRect={width:(t.getBoundingClientRect().width-50)/this.NOTE_CATEGORY,height:window.innerHeight/this.ONE_PAGE_NOTE_NUM,fill:"#fff",stroke:"#000",strokeWidth:.5},this.scheduleCursor()},scheduleCursor:function(){for(var t=this,e=Math.ceil(5/(30/this.tempo)),i=0;i<=29;i++)!function(i){i<=e-1?(Tone.Transport.clear(cursorSchedules[i]),cursorSchedules[i]=Tone.Transport.scheduleRepeat(function(e){t.activeJ=i,t.currentTime=.25*i*120/t.tempo,t.rectArray.forEach(function(t,e){t[i]&&Le.triggerAttackRelease(Tone.Frequency(60+Be[e],"midi"),.25)})},.25*e*120/t.tempo,.25*i*120/t.tempo)):i>e-1&&cursorSchedules[i]&&(Tone.Transport.clear(cursorSchedules[i]),cursorSchedules[i]="")}(i);console.log(cursorSchedules),console.log(Tone.Transport._scheduledEvents)},setupRect:function(t,e,i){var o="",n=e+10*(i-2)+1*this.NOTE_NUM_PER_SECTOR,a=.25*n*120/this.tempo<5;return o=n==this.activeJ&&this.rectArray[t][n]?a?"#6477b1":"#A9B9FF":n!=this.activeJ||this.rectArray[t][n]?this.rectArray[t][n]?a?We[t]:"#333740":a?"rgba(0,0,0,"+(.98-.3*t/this.NOTE_CATEGORY)+")":"#131315":a?"#292B3A":"#2B2E3D",F()({},this.configNoteRect,{x:t*this.configKonva.width/this.NOTE_CATEGORY,y:e*this.configKonva.height/this.ONE_PAGE_NOTE_NUM,fill:o})},handleTouchRect:function(t,e,i){Le.triggerAttackRelease(Tone.Frequency(60+Be[t],"midi"),.25);var o=this.rectArray[t].slice(0);o[e+(i-1)*this.NOTE_NUM_PER_SECTOR]=!o[e+(i-1)*this.NOTE_NUM_PER_SECTOR],this.$set(this.rectArray,t,o),qe=t,Fe=e},handleMoveRect:function(t,e,i){var o=e+(i-1)*this.NOTE_NUM_PER_SECTOR,n=Fe+(i-1)*this.NOTE_NUM_PER_SECTOR;if(e!=Fe)this.handleTouchRect(t,e,i);else if(t!=qe&&e==Fe){Le.triggerAttackRelease(Tone.Frequency(60+Be[t],"midi"),.25);var a=this.rectArray[t].slice(0);a[o]=!a[o],this.$set(this.rectArray,t,a);var s=this.rectArray[qe].slice(0);s[n]=!s[n],this.$set(this.rectArray,qe,s),qe=t,Fe=e}},startloop:function(){Tone.Transport.start("+0.1"),this.playing=!0},stoploop:function(){Tone.Transport.stop(),this.playing=!1},toggleReplay:function(){this.playing?this.stoploop():this.startloop()},minusTempo:function(){var t=this;this.tempo>60&&(this.tempo-=5,Tone.Transport.seconds=.25*this.activeJ*120/this.tempo,Tone.Transport.bpm.rampTo(this.tempo,.01),setTimeout(function(){t.scheduleCursor()},200))},addTempo:function(){var t=this;this.tempo<180&&(this.tempo+=5,Tone.Transport.seconds=.25*this.activeJ*120/this.tempo,Tone.Transport.bpm.rampTo(this.tempo,.01),setTimeout(function(){t.scheduleCursor()},200))},scrolldown:function(){var t=this;clearInterval($e),2==this.sector?this.NOTE_NUM_PER_SECTOR=8:this.NOTE_NUM_PER_SECTOR=1,this.sector<=1&&(this.sector+=1),$e=setInterval(function(){t.NOTE_NUM_PER_SECTOR+=1,10==t.NOTE_NUM_PER_SECTOR&&clearInterval($e)},50)},scrollup:function(){var t=this;clearInterval($e),1==this.sector?this.NOTE_NUM_PER_SECTOR=12:this.NOTE_NUM_PER_SECTOR=20,this.sector>=2&&(this.sector-=1),$e=setInterval(function(){t.NOTE_NUM_PER_SECTOR-=1,10==t.NOTE_NUM_PER_SECTOR&&clearInterval($e)},50)},checkBouncibility:function(){for(var t=[],e=0;e<=this.NOTE_CATEGORY-1;e++)for(var i=0;i<=29;i++)this.rectArray[e][i]&&t.push({note:Tone.Frequency(60+Be[e],"midi").toNote(),time:.25*i*120/this.tempo});return t.sort(function(t,e){return 0+t.time-e.time}),g(t)},bounceProject:function(){for(var t=this,e=[],i=0;i<=this.NOTE_CATEGORY-1;i++)for(var o=0;o<=29;o++)this.rectArray[i][o]&&e.push({note:Tone.Frequency(60+Be[i],"midi").toNote(),time:.25*o*120/this.tempo});this.$store.dispatch("BOUNCE_PROJECT",{record:e,info:{title:"尚未起名",content:"default",cover:"default"}}).then(function(e){console.log("successfully bounced"),t.bouncing=!1,t.$toast("作品已为您存储"),t.$router.push({path:"/new-music-box-viewer",query:{id:e}})}).catch(function(e){t.bouncing=!1,t.$toast("非常抱歉，上传作品失败了")})},submitProject:function(){this.checkBouncibility()?this.bounceProject():this.alertAppear=!0},clearProject:function(){},btnStart:function(t){var e=this;console.log(t),De=setTimeout(function(){e.showExtendBtns=!0},200)},btnEnd:function(t){clearTimeout(De);var e=document.elementFromPoint(t.changedTouches[0].clientX,t.changedTouches[0].clientY);console.log(e),e&&e.classList.contains("bounceBtn")?this.submitProject():e&&(e.classList.contains("playBtn")||e.classList.contains("pauseBtn"))?(this.toggleReplay(),this.showExtendBtns=!1):e&&(e.classList.contains("playBtn")||e.classList.contains("cancelBtn"))&&(this.showExtendBtns=!1)}},beforeRouteLeave:function(t,e,i){b(),i()},created:function(){this.setupCanvas();Tone.Transport.cancel();var t=document.documentElement;window.rem=t.getBoundingClientRect().width/10,t.style.fontSize=window.rem+"px",/micromessenger/.test(navigator.userAgent.toLowerCase())&&(Mt().then(function(){Ut({title:"MUSIXISE",desc:"划拉划拉八音盒",fullPath:""+location.origin+location.pathname+"#/new-music-box-roll",imgUrl:"http://oaeyej2ty.bkt.clouddn.com/Ocrg2srw_icon33@2x.png"})}),m("code")||H.get("serviceToken")?o(m("code")).then(function(t){t.data.errcode>=2e4&&(H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(location.origin+location.pathname+"#/new-music-box-roll")+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")),console.log("get user info success",t.data.data)}).catch(function(t){H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(location.origin+location.pathname+"#/new-music-box-roll")+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")}):location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(location.origin+location.pathname+"#/new-music-box-roll")+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"))},mounted:function(){},updated:function(){}}),Ge=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{},[i("div",{staticClass:"roll"},[i("v-stage",{attrs:{config:t.configKonva}},[i("v-layer",[t._l(t.NOTE_CATEGORY,function(e){return t._l(t.ONE_PAGE_NOTE_NUM,function(o){return i("v-rect",{key:""+e+o,attrs:{config:t.setupRect(e-1,o-1,t.sector)},on:{touchstart:function(i){t.handleTouchRect(e-1,o-1,t.sector)},touchmove:function(i){t.handleMoveRect(e-1,o-1,t.sector)}}})})})],2)],1)],1),t._v(" "),i("div",{staticClass:"control-panal"},[i("div",[i("div",{staticClass:"rotate",attrs:{id:"scrollup"},on:{touchstart:t.scrollup}}),t._v(" "),i("div",{attrs:{id:"scrolldown"},on:{touchstart:t.scrolldown}})]),t._v(" "),i("div",[i("div",{staticClass:"rotate",attrs:{id:"minustempo"},on:{touchstart:t.minusTempo}}),t._v(" "),i("div",{attrs:{id:"tempo-indicator"}},[i("div",{style:t.tempoLength,attrs:{id:"tempo-progress"}}),t._v(" "),i("p",{attrs:{id:"tempo-num"}},[t._v(t._s(this.tempo)+" bpm")])]),t._v(" "),i("div",{staticClass:"rotate",attrs:{id:"addtempo"},on:{touchstart:t.addTempo}})]),t._v(" "),i("div",{staticStyle:{position:"relative",display:"flex","align-items":"center","justify-content":"center",transform:"rotate(90deg)"}},[i("pie-progress",{attrs:{progress:100*t.currentTime/5}}),t._v(" "),i("p",{staticStyle:{position:"absolute","font-size":"12px"}},[t._v(t._s(t._f("intTime")(t.currentTime)))])],1),t._v(" "),i("div",{staticClass:"btnContainer",on:{touchstart:function(e){e.stopPropagation(),e.preventDefault(),t.btnStart(e)},touchend:function(e){e.stopPropagation(),e.preventDefault(),t.btnEnd(e)}}},[i("div",{class:[t.playing?"pauseBtn":"playBtn","rotate"],on:{click:t.toggleReplay}}),t._v(" "),i("div",{class:[t.showExtendBtns?"extendBtnsShow":"extendBtnsHide","extendBtns"]},[i("div",{staticClass:"bounceBtn rotate"}),t._v(" "),i("div",{staticClass:"cancelBtn"})])])]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.alertAppear,expression:"alertAppear"}],attrs:{id:"alert-mask"}},[i("div",{staticClass:"mb-dialog"},[i("div",{staticClass:"title"},[t._v("\n          减少些音符才能做成音乐盒，是否继续上传\n        ")]),t._v(" "),i("div",{staticClass:"btns"},[i("span",{staticClass:"btn cancel",on:{click:function(e){t.alertAppear=!1}}},[t._v("再调整")]),t._v(" "),i("span",{staticClass:"btn confirm",on:{click:t.bounceProject}},[t._v("任性上传")])])])])])],1)},Xe=[],Ve={render:Ge,staticRenderFns:Xe},Je=Ve,Ke=i("VU/8"),Ye=E,Ze=Ke(He,Je,!1,Ye,"data-v-0c05d5a7",null),Qe=Ze.exports,ti=i("bqTm"),ei=i.n(ti),ii={directives:{infiniteScroll:ei.a},components:{countButton:fe},data:function(){return{loading:!0,playing:!1,userId:0,isMe:!1,favStatus:!1,newWorkTitle:"",finalNewWorkTitle:"",busy:!0}},computed:{musixiserInfo:function(){return this.$store.state.musixiserInfo},musixiserWorksObj:function(){return this.$store.state.musixiserWorksObj}},methods:{loadMusixiserById:function(){console.log("my id: ",this.userId);var t=this.userId;this.$store.dispatch("FETCH_MUSIXISER",{id:t}),this.busy=!1},loadMore:function(){var t=this,e=this.userId;this.busy=!0,console.log("1111111",this.musixiserWorksObj.current),this.$store.dispatch("FETCH_WORKS_FROM_MUSIXISER",{id:e,page:this.musixiserWorksObj.current?this.musixiserWorksObj.current+1:1}).then(function(){console.log("2222222",t.musixiserWorksObj),t.musixiserWorksObj.content.length<t.musixiserWorksObj.total&&(t.busy=!1)})},togglePlay:function(){T(this.project),this.playing=!this.playing},toggleFav:function(){l({workId:this.$store.state.route.query.id,status:this.favStatus})},redirectToWork:function(t){this.$router.push({path:"/new-music-box-viewer",query:{id:t}})}},beforeRouteLeave:function(t,e,i){b(),i()},created:function(){var t=this,e=this,i=document.documentElement;if(window.rem=i.getBoundingClientRect().width/10,i.style.fontSize=window.rem+"px",!/micromessenger/.test(navigator.userAgent.toLowerCase()))return this.userId=this.$store.state.route.query.id||149,void e.loadMusixiserById();var n=""+location.origin+location.pathname+"#/new-music-box-viewer?id="+e.$store.state.route.query.id;Mt().then(function(){Ut({title:"MUSIXISE",desc:"我的地盘你就dê听我的",fullPath:n,imgUrl:"http://oaeyej2ty.bkt.clouddn.com/Ocrg2srw_icon33@2x.png"})}),m("code")||H.get("serviceToken")?o(m("code")).then(function(i){i.data.errcode>=2e4&&(H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(n)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")),e.userId=t.$store.state.route.query.id||i.data.data.userId,e.isMe=e.userId==i.data.data.userId,e.loadMusixiserById(),console.log("get user info success",i.data.data)}).catch(function(t){H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(n)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")}):location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(n)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")},mounted:function(){var t=this;setTimeout(function(){t.loading=!1},2e3)},updated:function(){}},oi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticClass:"worklist",attrs:{"infinite-scroll-disabled":"busy","infinite-scroll-distance":"10"}},t._l(t.musixiserWorksObj.content,function(e){return i("div",{staticClass:"work",on:{click:function(i){t.redirectToWork(e.id)}}},[i("img",{staticClass:"cover",attrs:{src:"default"==e.cover?e.userVO.smallAvatar:e.cover,alt:""}}),t._v(" "),i("div",{staticClass:"detail"},[i("div",{staticClass:"hairline"}),t._v(" "),i("div",{staticClass:"line line1"},[i("p",{staticClass:"title"},[t._v(t._s(e.title))]),t._v(" "),i("p",{staticClass:"date"},[t._v(t._s(e.createdDate))])]),t._v(" "),i("div",{staticClass:"line line2"},[i("p",{staticClass:"creator"},[t._v(t._s(e.userVO.realname))]),t._v(" "),i("p",{staticClass:"likes"},[t._v("收藏人数: "+t._s(e.collectNum))])])])])})),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.loading&&0==t.musixiserWorksObj.content.length,expression:"!loading && musixiserWorksObj.content.length==0"}],staticClass:"emptysection"},[t._m(0,!1,!1)])])},ni=[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("p",{staticClass:"emptytitle"},[t._v("暂无作品")]),t._v(" "),o("img",{staticStyle:{width:"6rem"},attrs:{src:i("SpEx"),alt:""}})])}],ai={render:oi,staticRenderFns:ni},si=ai,ri=i("VU/8"),ci=S,li=ri(ii,si,!1,ci,"data-v-051f4e98",null),di=li.exports,ui={directives:{infiniteScroll:ei.a},components:{countButton:fe},data:function(){return{loading:!0,playing:!1,userId:0,isMe:!1,favStatus:!1,newWorkTitle:"",finalNewWorkTitle:"",busy:!0}},computed:{musixiserInfo:function(){return this.$store.state.musixiserInfo},favWorksObj:function(){return this.$store.state.favWorksObj}},methods:{loadMusixiserById:function(){console.log("my id: ",this.userId);var t=this.userId;this.$store.dispatch("FETCH_MUSIXISER",{id:t}),this.busy=!1},loadMore:function(){var t=this,e=this.userId;this.busy=!0,console.log("1111111",this.favWorksObj.current),this.$store.dispatch("FETCH_FAV_WORKS",{id:e,page:this.favWorksObj.current?this.favWorksObj.current+1:1}).then(function(){console.log("2222222",t.favWorksObj),t.favWorksObj.content.length<t.favWorksObj.total&&(t.busy=!1)})},togglePlay:function(){T(this.project),this.playing=!this.playing},toggleFav:function(){l({workId:this.$store.state.route.query.id,status:this.favStatus})},redirectToWork:function(t){t&&this.$router.push({path:"/new-music-box-viewer",query:{id:t}})}},beforeRouteLeave:function(t,e,i){b(),i()},created:function(){var t=this,e=this,i=document.documentElement;if(window.rem=i.getBoundingClientRect().width/10,i.style.fontSize=window.rem+"px",!/micromessenger/.test(navigator.userAgent.toLowerCase()))return this.userId=this.$store.state.route.query.id||149,void e.loadMusixiserById();var n=""+location.origin+location.pathname+"#/new-music-box-viewer?id="+e.$store.state.route.query.id;Mt().then(function(){Ut({title:"MUSIXISE",desc:"我的地盘你就dê听我的",fullPath:n,imgUrl:"http://oaeyej2ty.bkt.clouddn.com/Ocrg2srw_icon33@2x.png"})}),m("code")||H.get("serviceToken")?o(m("code")).then(function(i){i.data.errcode>=2e4&&(H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(n)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")),e.userId=t.$store.state.route.query.id||i.data.data.userId,e.isMe=e.userId==i.data.data.userId,e.loadMusixiserById(),console.log("get user info success",i.data.data)}).catch(function(t){H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(n)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")}):location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(n)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")},mounted:function(){var t=this;setTimeout(function(){t.loading=!1},2e3)},updated:function(){}},pi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticClass:"worklist",attrs:{"infinite-scroll-disabled":"busy","infinite-scroll-distance":"10"}},t._l(t.favWorksObj.content,function(e){return i("div",{staticClass:"work",on:{click:function(i){t.redirectToWork(e.id)}}},[i("img",{staticClass:"cover",attrs:{src:"default"==e.cover?e.user.smallAvatar:e.cover,alt:""}}),t._v(" "),i("div",{staticClass:"detail"},[i("div",{staticClass:"hairline"}),t._v(" "),i("div",{staticClass:"line line1"},[i("p",{staticClass:"title"},[t._v(t._s(e.title))]),t._v(" "),i("p",{staticClass:"date"},[t._v(t._s(e.createdDate))])]),t._v(" "),i("div",{staticClass:"line line2"},[i("p",{staticClass:"creator"},[t._v(t._s(e.user.realname))]),t._v(" "),i("p",{staticClass:"likes"},[t._v("收藏人数: "+t._s(e.collectNum))])])])])})),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.loading&&0==t.favWorksObj.content.length,expression:"!loading && favWorksObj.content.length==0"}],staticClass:"emptysection"},[t._m(0,!1,!1)])])},vi=[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("p",{staticClass:"emptytitle"},[t._v("暂无作品")]),t._v(" "),o("img",{staticStyle:{width:"6rem"},attrs:{src:i("SpEx"),alt:""}})])}],hi={render:pi,staticRenderFns:vi},mi=hi,fi=i("VU/8"),gi=I,_i=fi(ui,mi,!1,gi,"data-v-66845376",null),wi=_i.exports,bi={components:{countButton:fe},data:function(){return{searching:!1,loading:!1,recommendations:{}}},computed:{},methods:{load:function(){u().then(function(t){console.log("index:",t)})},search:function(){}},beforeRouteLeave:function(t,e,i){b(),i()},created:function(){var t=this,e=document.documentElement;if(window.rem=e.getBoundingClientRect().width/10,e.style.fontSize=window.rem+"px",!/micromessenger/.test(navigator.userAgent.toLowerCase()))return void t.loadMusicById();var i=""+location.origin+location.pathname+"#/new-music-box-viewer?id="+t.$store.state.route.query.id;Mt().then(function(){Ut({title:"MUSIXISE",desc:"分享一个八音盒",fullPath:i,imgUrl:"https://oaeyej2ty.bkt.clouddn.com/Ocrg2srw_icon33@2x.png"})}),m("code")||H.get("serviceToken")?o(m("code")).then(function(e){e.data.errcode>=2e4&&(H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(i)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")),t.userId=e.data.data.userId,t.loadMusicById(),console.log("get user info success",e.data.data)}).catch(function(t){H.remove("serviceToken"),location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(i)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")}):location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx353a60a8b049d366&redirect_uri="+encodeURIComponent(i)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")},mounted:function(){var t=this;setTimeout(function(){t.loading=!1},2e3),setTimeout(function(){t.workIntroAppear=!0},4500),setTimeout(function(){t.controlPanalAppear=!0},5500)},updated:function(){}},Ti=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:["container",t.loading?"loading":""]},[i("div",{attrs:{id:"ground"}}),t._v(" "),t._m(0,!1,!1),t._v(" "),i("div",{attrs:{id:"mb"},on:{click:t.togglePlay}},[i("div",{class:["mb-part",t.playing?"playing":""],attrs:{id:"mb-lid"}}),t._v(" "),i("div",{staticClass:"mb-part",attrs:{id:"mb-body"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.playing,expression:"!playing"}],attrs:{id:"play-btn"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.playing,expression:"playing"}],attrs:{id:"pause-btn"}})])]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.playing,expression:"playing"}],attrs:{id:"music-aurora"}})]),t._v(" "),i("div",{attrs:{id:"low-leaf1"}}),t._v(" "),i("div",{attrs:{id:"low-leaf2"}}),t._v(" "),i("div",{attrs:{id:"low-leaf3"}}),t._v(" "),i("div",{attrs:{id:"low-leaf4"}}),t._v(" "),i("div",{attrs:{id:"mid-leaf1"}}),t._v(" "),i("div",{attrs:{id:"mid-leaf2"}}),t._v(" "),i("div",{attrs:{id:"mid-leaf3"}}),t._v(" "),i("div",{attrs:{id:"mid-leaf4"}}),t._v(" "),i("div",{attrs:{id:"top-leaf1"}}),t._v(" "),i("div",{attrs:{id:"top-leaf2"}}),t._v(" "),i("div",{attrs:{id:"top-leaf3"}}),t._v(" "),i("div",{attrs:{id:"top-leaf4"}}),t._v(" "),i("div",{attrs:{id:"top-leaf5"}}),t._v(" "),i("div",{attrs:{id:"top-leaf6"}}),t._v(" "),i("transition",{attrs:{name:"bounce"}},[t.workIntroAppear?i("div",{attrs:{id:"work-intro"}},[i("div",{staticClass:"title"},[t._v(t._s(t.finalNewWorkTitle||t.projectInfo.title))]),t._v(" "),i("div",{staticClass:"subtitle"},[i("span",[t._v("by")]),t._v(" "),i("span",[i("img",{attrs:{src:t.projectInfo.owner.smallAvatar,alt:""}})]),t._v(" "),i("span",[t._v(t._s(t.projectInfo.owner.nickName))])]),t._v(" "),t.userId===t.projectInfo.userId?i("div",{attrs:{id:"edit-work"},on:{click:function(e){t.titleUpdateAppear=!0}}}):t._e()]):t._e()]),t._v(" "),i("transition",{attrs:{name:"bounce"}},[t.controlPanalAppear?i("div",{attrs:{id:"control-panal"}},[i("count-button",{attrs:{initCount:t.projectInfo.collectNum?t.projectInfo.collectNum:0,initActive:!!t.projectInfo.favStatus,iconImg:"",onClickCall:t.toggleFav}}),t._v(" "),i("div",{staticClass:"purchaseBtn",on:{click:t.purchaseItem}},[t._v("购买")]),t._v(" "),i("div",{staticClass:"makeBtn",on:{click:t.redirectToMaker}},[t._v("编曲")])],1):t._e()]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.titleUpdateAppear,expression:"titleUpdateAppear"}],attrs:{id:"title-update-mask"}},[i("div",{staticClass:"mb-dialog"},[i("div",{staticClass:"title"},[t._v("作品名称")]),t._v(" "),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.newWorkTitle,expression:"newWorkTitle"}],attrs:{type:"text",placeholder:"作品新名称"},domProps:{value:t.newWorkTitle},on:{input:function(e){e.target.composing||(t.newWorkTitle=e.target.value)}}}),t._v(" "),i("div",{staticClass:"splitter"})]),t._v(" "),i("div",{staticClass:"btns"},[i("span",{staticClass:"btn cancel",on:{click:function(e){t.titleUpdateAppear=!1}}},[t._v("取消")]),t._v(" "),i("span",{staticClass:"btn confirm",on:{click:t.updateWorkTitle}},[t._v("确认")])])])])])],1)},Ci=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"spirit"}},[i("div",{staticClass:"spirit-part",attrs:{id:"spirit-body"}}),t._v(" "),i("div",{staticClass:"spirit-part",attrs:{id:"spirit-front-leaf"}}),t._v(" "),i("div",{staticClass:"spirit-part",attrs:{id:"spirit-back-leaf"}}),t._v(" "),i("div",{staticClass:"spirit-part",attrs:{id:"spirit-back1"}}),t._v(" "),i("div",{staticClass:"spirit-part",attrs:{id:"spirit-back2"}})])}],xi={render:Ti,staticRenderFns:Ci},yi=xi,ki=i("VU/8"),Ei=A,Si=ki(bi,yi,!1,Ei,"data-v-324355b7",null),Ii=Si.exports;N.a.use(st.a);var Ai=new st.a({routes:[{path:"/",name:"HelloWorld",component:mt},{path:"/new-music-box-maker",name:"NMBMaker",component:re},{path:"/new-music-box-roll",name:"MBRoll",component:Qe},{path:"/new-music-box-viewer",name:"NMBViewer",component:ke},{path:"/musixiser",name:"MusixiserDetail",component:di},{path:"/myfav",name:"MyFav",component:wi},{path:"/recommend",name:"Recommend",component:Ii}]});N.a.use(P.a,{defaultType:"center",duration:2500,wordWrap:!1,width:"auto"}),N.a.config.productionTip=!1;var Ni=function(){return new M.a.Store({state:{activeType:null,itemsPerPage:20,items:{},users:{},lists:{top:[],new:[],show:[],ask:[],job:[]},myInfo:{},recordParts:[],recordProject:[],musixiserInfo:{},musixiserWorksObj:{content:[]},favWorksObj:{content:[]}},actions:V,mutations:J,getters:K})}();Object(R.sync)(Ni,Ai),new N.a({el:"#app",router:Ai,store:Ni,template:"<App/>",components:{App:at}})},SpEx:function(t,e,i){t.exports=i.p+"static/img/oops.7bb4a06.png"},XgS5:function(t,e){},e195:function(t,e){},h4Ia:function(t,e){},h6L2:function(t,e){},hMCF:function(t,e){},v2ns:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.557f38b0de76c9eb0272.js.map